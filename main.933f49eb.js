parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"D7Zp":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tile=void 0;var n=function(){function t(i,n,l,o){e(this,t),this.value=n,this.htmlTileElement=void 0,this.isNew=o,this.isMerged=l,this.coords={row:i.row,cell:i.cell,index:i.index}}return i(t,[{key:"setTileHtmlElement",value:function(e){this.htmlTileElement=e}},{key:"setTileCoords",value:function(e,t,i){this.coords={row:e,cell:t,index:t+e*i}}},{key:"insertTileToView",value:function(e){e.append(this.htmlTileElement)}},{key:"removeTileFromView",value:function(){var e=this;setTimeout(function(){e.htmlTileElement.remove()},200)}}]),t}();exports.Tile=n;
},{}],"QSmu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Grid=void 0;var e=require("./Tile");function i(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function t(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}var l=function(){function t(e,r){i(this,t),this.size=e,this.view=r,this.changed=!1,this.maxValue=0,this.addition=0,this.matrix=this.createMatrix(this.size)}return r(t,[{key:"createMatrix",value:function(e){return Array.from({length:e},function(){return Array.from({length:e},function(){return null})})}},{key:"insertTileToGame",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getRandomEmptyCell(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random()<.9?2:4,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=new e.Tile(i,t,r,l),n=this.view.createTileElement();s.setTileHtmlElement(n),this.insertTileToGrid(s)}},{key:"insertTileToGrid",value:function(e){e.insertTileToView(this.view.gameTiles),this.matrix[e.coords.row][e.coords.cell]=e}},{key:"removeTileFromGrid",value:function(e,i){this.matrix[e][i].removeTileFromView(),this.matrix[e][i]=null}},{key:"getRandomEmptyCell",value:function(){var e=this.getAllEmptyCells();if(e.length)return e[Math.floor(Math.random()*e.length)]}},{key:"getAllEmptyCells",value:function(){var i=this,t=[];return this.checkEachCell(function(r,l,s){s instanceof e.Tile||t.push({row:r,cell:l,index:l+r*i.size})}),t}},{key:"checkEachCell",value:function(e){for(var i=0;i<this.size;i++)for(var t=0;t<this.size;t++)e(i,t,this.matrix[i][t])}},{key:"prepareGridBeforeMoving",value:function(){this.changed=!1,this.addition=0}},{key:"prepareTilesBeforeMoving",value:function(){this.checkEachCell(function(e,i,t){t&&(t.isNew=!1,t.isMerged=!1)})}},{key:"moveTiles",value:function(e){var i=e.revers,t=e.changeAxis;this.prepareGridBeforeMoving(),this.prepareTilesBeforeMoving();for(var r=0;r<this.size;r++){var l=i?this.size-1:0,s=i?l-1:1,n=i?-1:1;this.movementAlgorithm(l,s,n,r,t)}this.changed&&this.insertTileToGame()}},{key:"movementAlgorithm",value:function(e,i,t,r,l){for(var s=e,n=i;n>=0&&n<this.size;){var a=l?n:r,o=l?s:r,h=l?r:n,u=l?r:s;this.isTileExist(a,h)?n+=t:this.isTileExist(o,u)?(this.moveTileToNewCoords(a,o,h,u),this.changed=!0,n+=t):this.tilesValueEqual(a,o,h,u)?(this.mergerTiles(a,o,h,u),this.changed=!0,s+=t,n+=t):(s+=t)===n&&(n+=t)}}},{key:"tilesValueEqual",value:function(e,i,t,r){return this.matrix[i][r].value===this.matrix[e][t].value}},{key:"moveTileToNewCoords",value:function(e,i,t,r){this.matrix[i][r]=this.matrix[e][t],this.matrix[i][r].setTileCoords(i,r,this.size),this.matrix[e][t]=null}},{key:"mergerTiles",value:function(e,i,t,r){var l=this.matrix[i][r],s=l.coords,n=2*l.value;this.matrix[e][t].setTileCoords(i,r,this.size),this.view.setTilePositionRelativeToCell(this.matrix[i][r]),this.view.setTilePositionRelativeToCell(this.matrix[e][t]),this.removeTileFromGrid(i,r),this.removeTileFromGrid(e,t),this.insertTileToGame(s,n,!0,!1),this.updateMergerInfo(n)}},{key:"updateMergerInfo",value:function(e){this.addition+=e,this.maxValue<e&&(this.maxValue=e)}},{key:"isTileExist",value:function(e,i){return!this.matrix[e][i]}},{key:"emptyCellsAvailable",value:function(){return!!this.getAllEmptyCells().length}},{key:"mergerTilesPossible",value:function(){return this.matrix.flat().some(function(e,i,t){if(e){var r=!(!t[i+1]||(i+1)%4==0)&&e.value===t[i+1].value,l=!!t[i+4]&&e.value===t[i+4].value;return r||l}})}}]),t}();exports.Grid=l;
},{"./Tile":"D7Zp"}],"pO7Z":[function(require,module,exports) {
module.exports="try-again.62eaa584.gif";
},{}],"Zzsi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ViewManager=void 0;var e=require("./Tile"),t=i(require("../../images/try-again.gif"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function l(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var o=function(){function i(e){a(this,i),this.gameSize=e,this.gameBody=document.querySelector(".game-body"),this.gameGrid=document.querySelector(".game-body__grid"),this.gameTiles=document.querySelector(".game-body__tiles"),this.gameMessage=document.querySelector(".game-body__message"),this.gameCurrentScore=document.querySelector(".game-score__current"),this.gameCells=[],this.initialize()}return l(i,[{key:"initialize",value:function(){this.createGameGridCells()}},{key:"createGameGridCells",value:function(){for(var e=0;e<this.gameSize*this.gameSize;e++){var t=this.createElement("div","game-body__cell");this.gameGrid.append(t),this.gameCells.push(t)}}},{key:"createTileElement",value:function(){return this.createElement("div","tile")}},{key:"updateGameState",value:function(e,t,i){(t||i)&&this.hiddenTiles(e),t&&this.gameMessage.classList.add("game-body__message--won"),i&&(this.resetNoLoopGif(".game-body__try-again"),this.gameMessage.classList.add("game-body__message--over"))}},{key:"updateScoreState",value:function(e,t){if(this.gameCurrentScore.textContent="".concat(e),t){var i=this.createElement("div","game-score__addition","+".concat(t));this.gameCurrentScore.append(i),setTimeout(function(){i.remove()},800)}}},{key:"updateTilesState",value:function(t){var i=this;t.checkEachCell(function(t,a,n){n instanceof e.Tile&&(i.setTileClassName(n),i.setTilePositionRelativeToCell(n))})}},{key:"setTileClassName",value:function(e){e.isNew?e.htmlTileElement.className="tile tile--".concat(e.value," tile--new"):e.isMerged?e.htmlTileElement.className="tile tile--".concat(e.value," tile--merged"):e.htmlTileElement.className="tile tile--".concat(e.value)}},{key:"setTilePositionRelativeToCell",value:function(e){var t=this.getTilePositionRelativeToCell(e),i=t.left,a=t.top;e.htmlTileElement.style.left="".concat(i,"%"),e.htmlTileElement.style.top="".concat(a,"%")}},{key:"getTilePositionRelativeToCell",value:function(e){var t=this.gameCells[e.coords.index],i=t.offsetLeft,a=t.offsetTop;return{left:i/this.gameGrid.offsetWidth*100,top:a/this.gameGrid.offsetHeight*100}}},{key:"hiddenTiles",value:function(e){e.flat().filter(function(e){return e}).sort(function(e,t){return e.coords.index-t.coords.index}).forEach(function(e,t,i){setTimeout(function(){e.htmlTileElement.classList.add("tile--hidden")},1200/i.length*t)})}},{key:"createElement",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=document.createElement(e);return a.className=t,a.innerText=i,a}},{key:"resetNoLoopGif",value:function(e){var i=document.querySelector(e);i.style.background="url(".concat(t.default,"?").concat((new Date).getTime(),")"),i.style.backgroundSize="107%",i.style.backgroundPosition="center",i.style.backgroundRepeat="no-repeat"}},{key:"clear",value:function(){this.gameMessage.className="game-body__message",this.gameGrid.replaceChildren(),this.gameTiles.replaceChildren()}}]),i}();exports.ViewManager=o;
},{"./Tile":"D7Zp","../../images/try-again.gif":"pO7Z"}],"xvpC":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.InputManager=void 0;var i=function(){function e(n){t(this,e),this.target=n,this.moveCallback=void 0,this.updateCallback=void 0,this.direction={ArrowLeft:{revers:!1,changeAxis:!1},ArrowUp:{revers:!1,changeAxis:!0},ArrowRight:{revers:!0,changeAxis:!1},ArrowDown:{revers:!0,changeAxis:!0}},this.touchStartX=0,this.touchStartY=0,this.keydownListener=this.handleKeyDown.bind(this),this.tuchStartListener=this.handleTouchStart.bind(this),this.tuchEndListener=this.handleTouchEnd.bind(this),this.initialize()}return n(e,[{key:"initialize",value:function(){this.initEvents()}},{key:"setEventCallbacks",value:function(t,e){this.moveCallback=t,this.updateCallback=e}},{key:"handleKeyDown",value:function(t){var e=t.key;this.direction[e]&&(t.preventDefault(),this.moveCallback(this.direction[e]),this.updateCallback())}},{key:"handleTouchStart",value:function(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}},{key:"handleTouchEnd",value:function(t){var e=t.changedTouches[0].screenX-this.touchStartX,n=t.changedTouches[0].screenY-this.touchStartY,i=Math.abs(e/n),r=Math.abs(n/e),a=Math.abs(i>r?e:n),s=this.swipeDirection(e,n,i,r);a<30||this.direction[s]&&(t.preventDefault(),this.moveCallback(this.direction[s]),this.updateCallback())}},{key:"swipeDirection",value:function(t,e,n,i){return n>i?t>=0?"ArrowRight":"ArrowLeft":e>=0?"ArrowDown":"ArrowUp"}},{key:"initEvents",value:function(){document.addEventListener("keydown",this.keydownListener),this.target.addEventListener("touchstart",this.tuchStartListener),this.target.addEventListener("touchend",this.tuchEndListener)}},{key:"removeEvents",value:function(){document.removeEventListener("keydown",this.keydownListener),this.target.removeEventListener("touchstart",this.tuchStartListener),this.target.removeEventListener("touchend",this.tuchEndListener)}}]),e}();exports.InputManager=i;
},{}],"QU7Q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GameManager=void 0;var i=require("./Grid"),e=require("./ViewManager"),t=require("./InputManager");function s(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function n(i,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function r(i,e,t){return e&&n(i.prototype,e),t&&n(i,t),i}var a=function(){function n(r,a){s(this,n),this.size=r,this.winValue=a,this.score=0,this.over=!1,this.won=!1,this.view=new e.ViewManager(this.size),this.grid=new i.Grid(this.size,this.view),this.input=new t.InputManager(this.view.gameBody),this.initialize()}return r(n,[{key:"initialize",value:function(){this.grid.insertTileToGame(),this.grid.insertTileToGame(),this.input.setEventCallbacks(this.grid.moveTiles.bind(this.grid),this.updateState.bind(this)),this.updateState()}},{key:"isPossibleToContinue",value:function(){return this.grid.emptyCellsAvailable()||this.grid.mergerTilesPossible()}},{key:"updateState",value:function(){this.score+=this.grid.addition,this.isPossibleToContinue()?this.grid.maxValue===this.winValue&&(this.won=!0):this.over=!0,(this.won||this.over)&&this.input.removeEvents(),this.view.updateGameState(this.grid.matrix,this.won,this.over),this.view.updateScoreState(this.score,this.grid.addition),this.view.updateTilesState(this.grid)}},{key:"reload",value:function(){this.input.removeEvents(),this.view.clear()}}]),n}();exports.GameManager=a;
},{"./Grid":"QSmu","./ViewManager":"Zzsi","./InputManager":"xvpC"}],"KIzB":[function(require,module,exports) {
"use strict";var e=require("./components/GameManager");document.addEventListener("DOMContentLoaded",function(){var n=new e.GameManager(4,2048);document.addEventListener("click",function(a){a.target.closest(".game-header__button, .game-body__try-again-btn")&&(n.reload(),n=new e.GameManager(4,2048))})});
},{"./components/GameManager":"QU7Q"}]},{},["KIzB"], null)
//# sourceMappingURL=main.933f49eb.js.map